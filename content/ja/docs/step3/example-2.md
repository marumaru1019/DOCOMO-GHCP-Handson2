---
title: "問題2: ダークモード機能の実装"
categories: [実践演習, GitHub Copilot]
tags: [react, css, theme, dark-mode]
weight: 2
---

## 問題

GitHub Copilotと協力して、GHCP-TodoAppにダークモード切り替え機能を0から実装してください。設計から実装、テストまでの一連の開発プロセスを体験します。

### 📝 実装要件

以下の要件を満たすダークモード機能を実装してください：

#### UI/UX要件
- **切り替えボタン**: TodoApp画面の右上端（カンバン表示ボタンの隣）に配置
- **ボタンデザイン**: 丸いボタン
- **アイコン表示**: ライトモード時🌙、ダークモード時☀️
- **ホバー効果**: ボタンにマウスを乗せると薄く光る
- **応答性**: クリック時の即座なテーマ変更
- **キーボード操作**: EnterキーとSpaceキーで切り替え可能

#### デザイン要件
- **ライトモード**: 全体の背景色 `bg-white`
- **ダークモード**: 全体の背景色 `bg-gray-900`
- **読みやすさ**: 各モードで十分なコントラストを確保
- **一貫性**: 既存のデザインシステムとの調和

#### 技術要件
- **Tailwind CSS**: dark:プレフィックスを使用
- **TypeScript**: 型安全な実装
- **テスト**: コンポーネントとカスタムフックのテスト実装

### 🎯 ゴール

以下の機能を完全に実装することがゴールです：

1. **動作する機能**
   - 右上の🌙/☀️ボタンでライト/ダークモードを切り替えられる
   - ボタンクリックで即座に画面全体のテーマが変わる
   - 現在のモードに応じてアイコンが正しく表示される（ライト時🌙、ダーク時☀️）
   - Enter と Space キーでダークモードの切り替えができる

2. **デザイン品質**
   - ライトモード：白背景（bg-white）で黒文字、読みやすい表示
   - ダークモード：黒背景（bg-gray-900）で白文字、目に優しい表示
   - ボタンのホバー効果が動作する
   - 既存のTodoアプリデザインと調和している

3. **技術品質**
   - useThemeカスタムフックで状態管理が実装されている
   - TypeScriptで型安全にコードが書かれている
   - コンポーネントとフックのテストが実装され、すべて通過する
   - Tailwindのdark:プレフィックスを活用している

### ✅ ゴールの確認方法

以下の手順をすべてクリアできればゴール達成です：

#### 1. 機能動作テスト

**手順1: 基本動作確認**
```bash
npm run dev
```
→ ブラウザでアプリケーションを開き、以下を確認：
- テーマ切り替え機能が動作する
- 両モードで全ての要素が適切に表示される
- 切り替え操作が直感的に行える

#### 2. コード品質テスト

**手順2: 自動テスト実行**
```bash
npm test
```
→ 実装したコンポーネントとフックのテストがすべて通過すること

**手順3: 機能テストの確認**
以下の動作する機能がテストコードで正しく検証されていることを確認：
- [ ] 🌙/☀️ボタンのクリックでテーマ切り替えが動作する
- [ ] ボタンクリック時に画面全体のテーマが即座に変更される
- [ ] 現在のモードに応じてアイコンが正しく表示される（ライト時🌙、ダーク時☀️）
- [ ] EnterキーとSpaceキーでダークモードの切り替えができる

**手順4: 型チェック**
```bash
npx tsc --noEmit
```
→ TypeScriptの型エラーがないこと

#### 3. ユーザビリティ確認

**確認項目**
- [ ] モードの切り替えが分かりやすい
- [ ] 現在のモードが一目で判別できる
- [ ] 両モードで十分な読みやすさがある
- [ ] 全ての要素でテーマが一貫している
- [ ] 切り替えがスムーズに動作する

**ゴール達成の判定:**
上記1-3のすべての手順で問題がなければ**ゴール達成**です！

---

## 📋 進め方

> **💡 注意**
> 以下に示す進め方は**一例**です。本ハンズオンを通して学んだGitHub Copilotの活用方法や効果的な指示の出し方を活かして、**あなた自身の方法で実装まで進めてください**。
>
> **推奨アプローチ：**
> - これまでの演習で身につけた `#codebase`、`#fetch` などの活用パターンを応用する
> - 段階的に実装を進める際の指示の粒度や順序を自分で考える
> - エラーが発生した場合のデバッグ指示の出し方を工夫する
> - 要件を満たしているかの確認方法を自分なりに設計する
>
> 下記の手順は参考として活用し、より効果的だと思う方法があれば積極的に試してみてください。

#### Step 1: 要件整理と設計

1. **要件分析と設計方針検討**
   ```markdown
   #codebase

   ダークモード機能の実装要件を分析し、以下の観点から最適な設計を行ってください。

   【現状分析】
   - 既存のコンポーネント構造とスタイリング方法
   - 現在の状態管理パターン
   - UI/UXの整合性要件

   【設計課題】
   - ユーザーが直感的に操作できるインターフェースデザイン
   - システム全体で一貫性を保つアーキテクチャ
   - 保守性と拡張性を両立する実装方式
   ```

#### Step 2: 段階的実装

1. **テーマ切り替えUI実装**
   ```markdown
   Step 1で策定した設計に基づいて、テーマ切り替えUIを実装してください：

   【実装要求】
   - 要件定義に従った配置・デザイン・アイコンの実装
   - ユーザビリティを重視したインタラクション設計
   - 既存UIとの整合性確保
   - TypeScript による型安全な実装

   設計意図を説明しながら実装を進めてください。
   ```

2. **テーマ管理システム実装**
   ```markdown
   設計したアーキテクチャに基づき、テーマ管理の仕組みを実装してください：

   【実装要求】
   - useTheme カスタムフックによる状態管理
   - パフォーマンスを考慮した効率的な実装
   - 拡張性のあるテーマシステム設計

   実装した設計判断の根拠も併せて説明してください。
   ```

3. **全体統合とスタイル適用**
   ```markdown
   #codebase

   テーマシステムを既存のTodoAppに統合し、要件定義の色彩仕様を適用してください：

   【統合要求】
   - 全コンポーネントへのテーマ適用（bg-white/bg-gray-900等）
   - 一貫性のあるスタイル適用
   - 既存機能への影響最小化
   - パフォーマンス最適化

   統合時の技術的な判断理由を明記してください。
   ```

4. **実装品質確認**
   ```markdown
   #codebase

   Step 1で策定した設計に基づいて、ダークモードが実装されているかどうかを確認してください。
   ```

#### Step 3: テスト実装

1. **動作機能テスト**
   ```markdown
   ゴールで定義した「動作する機能」の要件に基づいて、包括的なテストを作成してください：

   【動作する機能】
   - 🌙/☀️ボタンのクリックでテーマ切り替えが動作すること
   - ボタンクリック時に画面全体のテーマが即座に変更されること
   - 現在のモードに応じてアイコンが正しく表示されること（ライト時🌙、ダーク時☀️）
   - EnterキーとSpaceキーでダークモードの切り替えができること
   ```

   **テスト実装後の確認**
   ```markdown
   #codebase

   作成したテストファイルを確認し、ゴールで定義した4つの動作機能が適切にテストされているかチェックしてください：

   【確認項目】
   1. 🌙/☀️ボタンのクリックでテーマ切り替えが動作することのテストが実装されているか
   2. ボタンクリック時に画面全体のテーマが即座に変更されることのテストが実装されているか
   3. 現在のモードに応じてアイコンが正しく表示されることのテストが実装されているか
   4. EnterキーとSpaceキーでダークモードの切り替えができることのテストが実装されているか

   各テストケースが要件を満たしているか詳細に分析し、不足している部分があれば追加実装を提案してください。
   ```

2. **UIコンポーネントテスト**
   ```markdown
   実装したテーマ切り替えコンポーネントの包括的なテストを作成してください：

   - 基本的な表示テスト
   - ユーザー操作のテスト
   - 状態変化のテスト
   - エラーケースのテスト
   ```

   **テスト品質確認**
   ```markdown
   #codebase

   作成したUIコンポーネントのテストファイルを確認し、以下の観点でテスト品質をチェックしてください：

   【確認観点】
   - コンポーネントの基本的なレンダリングが正しくテストされているか
   - ユーザーのクリック操作に対する反応がテストされているか
   - プロパティの変更に応じた表示変化がテストされているか
   - エラーハンドリングや境界値のテストが含まれているか

   不足しているテストケースがあれば具体的に指摘し、追加実装を提案してください。
   ```

3. **システムテスト**
   ```markdown
   テーマ管理システム全体のテストを実装してください：

   - 状態管理ロジックのテスト
   - 統合された機能のテスト
   - パフォーマンステスト（必要に応じて）
   ```

   **システム統合テスト確認**
   ```markdown
   #codebase

   実装したシステムテストを確認し、テーマ管理システム全体が適切にテストされているかチェックしてください：

   【確認項目】
   - useThemeフックの状態管理ロジックが正しくテストされているか
   - コンポーネント間の連携（統合機能）がテストされているか
   - エッジケースやエラーハンドリングがカバーされているか
   - テストの可読性と保守性が確保されているか

   システム全体の品質保証の観点から、追加すべきテストケースがあれば提案してください。
   ```

#### Step 4: 最終確認

```bash
# 開発サーバー起動で動作確認
npm run dev

# テスト実行
npm test ThemeToggleButton
npm test useTheme
```

---

## ヒント

### 💡 効率的な実装アプローチ
**1. 要件のドキュメント化**
進め方の Step1 で行う設計だが、Copilot に指示を出すときにマークダウン形式であるファイルに吐き出すように依頼すると後で明示的に参照させることもできて便利です。

```markdown
#codebase
ダークモード機能の実装要件を分析し、以下の観点から最適な設計を行ってください。
なお、設計は設計書.md に出力してください。
```


**2. Tailwind CSS の最新ダークモード仕様確認**

ダークモードの実装の際に Tailwind CSSの公式ドキュメントを参照することで、最新の仕様を Copilot にコンテキストとして提供できます。


```markdown
#fetch https://tailwindcss.com/docs/dark-mode

Tailwind CSSの公式ドキュメントからダークモードの実装方法を取得してください。特に以下の点を確認してください：

- dark:プレフィックスの正しい使用方法
- 設定ファイルでのdarkModeオプション
- クラスベースとメディアクエリベースの切り替え方法
- 実際のコード例
```

**3. デザインのスクリーンショットの活用**
デザインのスクリーンショットを Copilot にコンテキストとして与えることで、デザインの方向性を明確にすることができます。
[新規機能の設計のTips]({{< relref "../step2/example-2#pen-例題" >}}) に Copilot に画像をコンテキストとして提供する方法を記載しているので御覧ください。

### 🛠️ デバッグとトラブルシューティング

**1. ダークモードのボタンを押してもうまく背景が切り替わらないとき**

Copilot にデバッグログを出力するような指示を出すことで、問題の特定を助けることができます。

```markdown
#codebase
ダークモードの切り替えボタンを押しても背景色が切り替わらない。
切替時の背景色をログに出力して、問題の原因を特定してください。
```

簡単な事象の場合漠然と事象だけ伝えて解消するケースもあります。
```markdown
#codebase
ダークモードの切り替えボタンを押しても背景色が切り替わらない。
原因を特定して解消してください。
```

**2. 参考実装の活用**

うまく動作しない場合、公式ドキュメントとの差異を比較させることで問題の特定を助けることができます。
```markdown
ダークモードの切り替えボタンを押しても背景色が切り替わらない。
公式ドキュメントと比較して、設定に誤りがないか確認してください。
#fetch https://tailwindcss.com/docs/dark-mode
```

**3. 画面上に表示されるエラーの解消**

画面上に表示されるエラーに関しては、スクリーンショットを取ってそのまま Copilot にコンテキストとして与えて解消を指示できます。
```markdown
添付した画像のエラーを解消して。
```

エラー画面
![エラー画面](../images/error-screen.png)

指示を出している様子
![指示を出している様子](../images/error-instruction.png)

**4. 型エラーの解消**
TypeScriptの型エラーが発生した場合、ターミナルのエラーメッセージをコンテキストとして与えることで効率よく解消できます。
```markdown
#terminalSelection
発生している型エラーを解消して。
```

または、問題をコンテキストとして与えてあげることでエラーの内容を効率よく解消できます。
詳細は、[エラーが起きたときの対処法]({{< relref "../step2/example-3/#3-エラーが起きた際の対処法" >}}) でまとめておりますのでご覧ください。


この問題を通じて、実用的な機能の0から1への実装プロセスと、GitHub Copilotを活用した効率的な開発手法を身につけることができます。
